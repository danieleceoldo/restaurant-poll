<!DOCTYPE html>
<html>
    <head>
        <title>
            {% now "N d, o" %}
        </title>
        <meta http-equiv="refresh" content="60">
        {% load static %}
        <link rel="stylesheet" type="text/css" href="{% static 'polls/styles.css' %}" />
    </head>

    <body>
        <header>
            <h1>
                {% now "N d, o" %}
            </h1>
        </header>

        <div class="frame">
            <nav class="bar_left">
                <p>&nbsp;</p>
            </nav>
            <nav class="bar_right">
                <p>&nbsp;</p>
            </nav>
            <nav class="bar_center">
                <p>
                   Current Local Time: {% now "H:i" %}
                </p>
            </nav>
        </div>

        <div class="frame">
            <section>
                {% if error_message %}

                    <p><strong>{{ error_message }}</strong></p>

                {% else %}

                    <h2>The Winner is: {{ ballot.winner }}</h2>

                    <h3>Total votes: {{ total_votes }}</h3>

                    <table class="result">
                    {% for restaurant in ballot.restaurant_set.all %}
                        <tr class="result">
                            <td style="padding-right:5em">
                            {{ restaurant.name }}</td>
                            <td style="padding-right:1em">
                            {{ restaurant.votes }}</td>
                            <td>vote{{ restaurant.votes|pluralize }}</td>
                        </tr>
                    {% endfor %}
                    </table>

                    <br>
                    <p>Victory cause: <strong>{{ ballot.win_cause }}</strong></p>
                    <p>Today total feedback marks: {{ total_marks }}</p>
                    <p>Today number of feedback: {{ feedback_num }}</p>

                {% endif %}

                <br>

                {% if graphs %}

                <ul class="tab">
                    <li><a href="javascript:void(0)" class="tablinks" onclick="openCity(event, 'feedback_history')" id="defaultOpen">Feedback History</a></li>
                    <li><a href="javascript:void(0)" class="tablinks" onclick="openCity(event, 'win_history')">Win History</a></li>
                    <li><a href="javascript:void(0)" class="tablinks" onclick="openCity(event, 'wins')">Wins</a></li>
                    <li><a href="javascript:void(0)" class="tablinks" onclick="openCity(event, 'feedback_lwsma')">LWSMA</a></li>
                    <li><a href="javascript:void(0)" class="tablinks" onclick="openCity(event, 'feedback_sma')">SMA</a></li>
                </ul>

                {% load static %}

                <div id="feedback_history" class="tabcontent">
                    <img src="{% static "polls/images/feedback_graph.png" %}" alt="Feedback History" style="display: block; margin: 0 auto; margin-top: 20px; margin-bottom: 20px"/>
                </div>

                <div id="win_history" class="tabcontent">
                    <img src="{% static "polls/images/win_history_graph.png" %}" alt="Win History" style="display: block; margin: 0 auto; margin-top: 20px; margin-bottom: 20px"/>
                </div>

                <div id="wins" class="tabcontent">
                    <img src="{% static "polls/images/win_graph.png" %}" alt="Wins" style="display: block; margin: 0 auto; margin-top: 20px; margin-bottom: 20px"/>
                </div>

                <div id="feedback_lwsma" class="tabcontent">
                    <img src="{% static "polls/images/feedback_lwsma_graph.png" %}" alt="Linear Weighted Simple Moving Average Feedback History" style="display: block; margin: 0 auto; margin-top: 20px; margin-bottom: 20px"/>
                </div>

                <div id="feedback_sma" class="tabcontent">
                    <img src="{% static "polls/images/feedback_sma_graph.png" %}" alt="Simple Moving Average Feedback History" style="display: block; margin: 0 auto; margin-top: 20px; margin-bottom: 20px"/>
                </div>

                {% else %}

                <p><strong>Sorry, calculating graphs. Please wait few seconds.</strong></p>

                {% endif %}

            </section>

            <nav class="aside">
            {% if not error_message %}
                <p><a href="{% url 'polls:feedback_detail' %}">
                Submit Feedback</a></p>
            {% endif %}
                <p><a href="{% url 'polls:statistics' %}">
                Statistics</a></p>
                <p><a href="{% url 'polls:vote_history_index' %}">
                Vote History</a></p>
                <p><a href="{% url 'polls:feedback_history' %}">
                Feedback History</a></p>
            </nav>

        </div>

        <div class="frame">
            <footer class="bar_left">
                <p>&nbsp;</p>
            </footer>
            <footer class="bar_right">
                <p>&nbsp;</p>
            </footer>
            <footer class="bar_center">
                {% if not error_message %}
                    <p><em>Submit a feedack from {{ feedback_open_time|time:"H:i" }}
                    to {{ feedback_close_time|time:"H:i" }} local time.</em></p>
                {% endif %}
            </footer>
        </div>

        <script src="{% static 'polls/tab_script.js' %}"></script>

    </body>
</html>
